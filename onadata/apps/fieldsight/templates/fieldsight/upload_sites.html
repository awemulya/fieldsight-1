{% extends "fieldsight/fieldsight_base.html" %}
{% load i18n staticfiles %}

{% block page-title %}{{ scenario }} {% trans 'Site' %}{% endblock %}
{%block extracss %}
<style>
    .alert {
        position: fixed;
        top: 130px;
        right: 30px;
        z-index: 999;
        max-width:400px;
}
</style>
{% endblock %}
{% block head %}
{% if terms_and_labels %}
    <a class="btn btn-success btn-raised" href="{% url 'fieldsight:sites-list' project %}">{{obj.terms_and_labels.site}}</a>

{% else %}
    <a class="btn btn-success btn-raised" href="{% url 'fieldsight:sites-list' project %}">{% trans 'Sites' %}</a>

{% endif %}

{% endblock %}


{% block content %}

<div id="main-content" class="padding">
    <nav aria-label="breadcrumb" role="navigation">
        {% block breadcrumbs %}
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'fieldsight:project-dashboard' project %}">{{ obj.name }}</a></li>
            {% if terms_and_labels %}
                <li class="breadcrumb-item active" aria-current="page">{% trans 'Bulk' %} {{obj.terms_and_labels.site}} {% trans 'Upload' %}</li>

            {% else %}
                <li class="breadcrumb-item active" aria-current="page">{% trans 'Bulk' %} {% trans 'Site' %} {% trans 'Upload' %}</li>

            {% endif %}
        </ol>
        {% endblock %}
    </nav>
        {% if messages %}

                {% for message in messages %}
                    <div class="alert alert-{% if message.tags %}{{message.tags}} {% endif %}">
                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">
                            Ã—</button>
                        <span class="glyphicon glyphicon-info-sign"></span> <strong>Message</strong>
                        <hr class="message-inner-separator">
                        <p>
                            {{message}}</p>
                    </div>
                {% endfor %}

        {% endif %}


    <section class="panel">
        <header class="panel-heading clearfix">
            {% if terms_and_labels %}
                <h3><i class="la la-files-o"></i>{% trans 'Bulk' %} {{obj.terms_and_labels.site}} {% trans 'Upload' %}</h3>

            {% else %}
                <h3><i class="la la-files-o"></i>{% trans 'Bulk' %} {% trans 'Site' %} {% trans 'Upload' %}</h3>
            {% endif %}
        </header>

        <div class="panel-body">

            <div class="download-section">
                <fieldset>
                    <legend>
                        {% trans 'Download' %} {% trans 'empty' %} {% trans 'template:' %}
                    </legend>
                    <a href="{% url 'fieldsight:excel_bulk_site_sample' project %}" target="_blank">
                        {% trans 'Download' %} {% trans 'Excel' %} {% trans 'File' %}
                    </a>
                </fieldset>
                <fieldset>
                    <legend>
                        {% trans 'Download' %} {% trans 'for' %} {% trans 'editing:' %}
                    </legend>
                    {% if terms_and_labels %}
                        {% trans 'Filter' %} {% trans 'by' %} {{obj.terms_and_labels.region}}
                        <select id="regions" placeholder="Filter by {{obj.terms_and_labels.region}}" multiple>

                    {% else %}
                        {% trans 'Filter' %} {% trans 'by' %} {% trans 'regions' %}
                        <select id="regions" placeholder="Filter by regions" multiple>

                    {% endif %}

                        {% for region in regions %}
                        <option value="{{ region.id }}">{{ region.name }}</option>
                        {% endfor %}
                    </select>
                    <a id="download-for-edit" href="{% url 'fieldsight:excel_bulk_site_sample' project 1 %}">
                        {% trans 'Download' %} {% trans 'Excel' %} {% trans 'File' %}
                    </a>
                </fieldset>
            </div>

            <div id="newOrganization" class="margin-top upload-section">
                <legend>{% trans 'Upload' %} {% trans 'File' %}</legend>
                <form enctype="multipart/form-data" method="post" action="{% url 'fieldsight:site-upload' project %}">

                    <div class="form-row">
                        {% csrf_token %}
                        {{ form.media }}
                        {% for field in form %}

                        <label class="col-form-label">{{ field }}</label>
                        <label class="col-form-label">{{ field.errors }}</label>

                        {% endfor %}

                    </div>
                    <button type="submit" class="btn btn-primary">{% trans 'Upload' %} {% trans 'Excel' %} {% trans 'File' %}</button>
                    <span style="font-color:red;" >{{ form.non_field_errors }}
                </form>
            </div>
        </div>
    </section>

</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.4/css/selectize.bootstrap3.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.4/js/standalone/selectize.min.js"></script>
<script>
    $(document).ready(() => {
        const regionsSelectize = $('#regions').selectize();
        const downloadAnchor = $('#download-for-edit');
        const downloadUrl = "{% url 'fieldsight:excel_bulk_site_sample' project 1 %}";

        downloadAnchor.attr('href', downloadUrl);

        $('#regions').change(() => {
            const regionsVal = $('#regions').val();
            if (!regionsVal || regionsVal.length === 0) {
                downloadAnchor.attr('href', downloadUrl);
            } else {
                downloadAnchor.attr('href', downloadUrl + '?regions=' + regionsVal.join(','));
            }
        });

        {% if selected_regions %}
        const regionsVal = [{% for r in selected_regions %}'{{r}}', {% endfor %}];
        regionsSelectize[0].selectize.setValue(regionsVal);
        {% endif %}
    });
</script>

<!-- move following to proper css file -->
<style>
    .download-section {
    }

    .download-section fieldset {
        margin-bottom: 16px;
        font-size: 12px;
    }

    .download-section fieldset legend {
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 0;
    }

    .download-section a {
        font-size: 14px;
    }

    .upload-section {
        margin: 16px 0;
        font-size: 12px;
    }

    .upload-section legend {
        font-size: 16px;
        font-weight: 400;
        border-bottom: 1px solid rgba(0, 0, 0, 0.3);
    }

    .upload-section button[type="submit"] {
        cursor: pointer;
        font-size: 14px;
    }
</style>
{% endblock %}
