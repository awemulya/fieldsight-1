{% extends "fieldsight/fieldsight_base.html" %}
{% load i18n staticfiles %}
{% load filters %}
{% block kocript %}



<!-- for tagging feature in email invite -->

  <link href="{{ STATIC_URL }}css/jquery.tagit.css" rel="stylesheet" type="text/css">
    <link href="{{ STATIC_URL }}css/tagit.ui-zendesk.css" rel="stylesheet" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="{{ STATIC_URL }}js/tag-it.js" type="text/javascript" charset="utf-8"></script>
    <style type="text/css">
        .invalid{
            border: 1px solid red !important;
        }
    </style>
    <script>
        $(function(){
         

            //-------------------------------
            // Tag events
            //-------------------------------
            var email1OrgTags = $('#email1OrgTags');

            var addEvent = function(text) {
                $('#events_container').append(text + '<br>');
            };

            email1OrgTags.tagit({
              
                beforeTagAdded: function(evt, ui) {
                    if (!ui.duringInitialization) {
                        addEvent('beforeTagAdded: ' + email1OrgTags.tagit('tagLabel', ui.tag));
                    }
                },
                afterTagAdded: function(evt, ui) {
                    emails1=email1OrgTags.tagit('assignedTags')
                    console.log(emails1);
                },
                beforeTagRemoved: function(evt, ui) {
                    
                },
                afterTagRemoved: function(evt, ui) {
                    emails1=email1OrgTags.tagit('assignedTags')
                    console.log(emails1);
                },
                onTagClicked: function(evt, ui) {
                    addEvent('onTagClicked: ' + email1OrgTags.tagit('tagLabel', ui.tag));
                },
                onTagExists: function(evt, ui) {
                    addEvent('onTagExists: ' + email1OrgTags.tagit('tagLabel', ui.existingTag));
                }
            });


            var email2OrgTags = $('#email2OrgTags');

            var addEvent = function(text) {
                $('#events_container').append(text + '<br>');
            };

            email2OrgTags.tagit({
             
                afterTagAdded: function(evt, ui) {
                    emails2=email2OrgTags.tagit('assignedTags')
                    console.log(emails2);
                },
             
                afterTagRemoved: function(evt, ui) {
                    emails2=email2OrgTags.tagit('assignedTags')
                    console.log(emails2);
                },
             
            });
          

           var email1ProjectTags = $('#email1ProjectTags');

            var addEvent = function(text) {
                $('#events_container').append(text + '<br>');
            };

            email1ProjectTags.tagit({
              
                
                afterTagAdded: function(evt, ui) {
                    emails1=email1ProjectTags.tagit('assignedTags')
                    console.log(emails1);
                },
                
                afterTagRemoved: function(evt, ui) {
                    emails1=email1ProjectTags.tagit('assignedTags')
                    console.log(emails1);
                },
                
            });


            var email2ProjectTags = $('#email2ProjectTags');

            var addEvent = function(text) {
                $('#events_container').append(text + '<br>');
            };

            email2ProjectTags.tagit({
              
              
                afterTagAdded: function(evt, ui) {
                    emails2=email2ProjectTags.tagit('assignedTags')
                    console.log(emails2);
                },
               
                afterTagRemoved: function(evt, ui) {
                    emails2=email2ProjectTags.tagit('assignedTags')
                    console.log(emails2);
                },
               
            });

            var email3ProjectTags = $('#email3ProjectTags');

            var addEvent = function(text) {
                $('#events_container').append(text + '<br>');
            };

            email3ProjectTags.tagit({
              
              
                afterTagAdded: function(evt, ui) {
                    emails3=email3ProjectTags.tagit('assignedTags')
                    console.log(emails3);
                },
               
                afterTagRemoved: function(evt, ui) {
                    emails3=email3ProjectTags.tagit('assignedTags')
                    console.log(emails3);
                },
               
            });
          

          var email1SiteTags = $('#email1SiteTags');

            var addEvent = function(text) {
                $('#events_container').append(text + '<br>');
            };

            email1SiteTags.tagit({
              
                
                afterTagAdded: function(evt, ui) {
                    emails1=email1SiteTags.tagit('assignedTags')
                    console.log(emails1);
                },
                
                afterTagRemoved: function(evt, ui) {
                    emails1=email1SiteTags.tagit('assignedTags')
                    console.log(emails1);
                },
                
            });


            var email2SiteTags = $('#email2SiteTags');

            var addEvent = function(text) {
                $('#events_container').append(text + '<br>');
            };

            email2SiteTags.tagit({
              
              
                afterTagAdded: function(evt, ui) {
                    emails2=email2SiteTags.tagit('assignedTags')
                    console.log(emails2);
                },
               
                afterTagRemoved: function(evt, ui) {
                    emails2=email2SiteTags.tagit('assignedTags')
                    console.log(emails2);
                },
               
            });
            
        });
    </script>



    <!-- end for taggit feature -->




<link rel="stylesheet" href="{% static 'css/toastr.css' %}">
<script type="text/javascript" src="{{ STATIC_URL }}js/fieldsight/plugin/toastr.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.blockUI.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/fieldsight/App.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/fieldsight/manage_people_site.js?v=1.1"></script>

<script>
var emails1=[];
var emails2=[];
var emails3=[];

var proj_site_url = "";
var userurl = "";
var speed=0;
var selected_users=[];
var all_users=[];
var selected_proj_site=[];
var all_proj_site=[];
var CSRF_TOKEN = '{{ csrf_token }}';

{% if type == "project" %}

  {% if obj.cluster_sites %}
    var proj_region_url = '{% url 'fieldsight:project_regions_list' pk %}';
    //assignurl = '{% url 'fieldsight:multi_user_region_assign' pk %}';
    assignurl = '{% url 'fieldsight:assign_regional_users' pk %}';
    assign_users_to_entire_project_url = '{% url 'fieldsight:assign_users_to_entire_project' pk %}';

    // assignurl = '{% url 'fieldsight:multi_user_site_assign' pk %}';
    
    var type = "region";
  {% else %}
    var proj_site_url = '{% url 'role:multi_ops_list' 0 pk %}';
    assignurl = '{% url 'fieldsight:multi_user_site_assign' pk %}';
    var type = "site";
  {% endif %}
  userurl = '{% url 'role:multi_user_list' 1 pk %}';
  

{% elif type == "org" %}
  
  var proj_site_url = '{% url 'role:multi_ops_list' 1 pk %}';
  userurl = '{% url 'role:multi_user_list' 1 pk %}';
  assignurl = '{% url 'fieldsight:multi_user_project_assign' pk %}'

{% endif %}

$(document).ready(function() {
var pk = "{{pk}}";
var level = "{{level}}";
var organization = "{{organization}}";
var csrf_token = "{{csrf_token}}";

assigntoken(csrf_token);
vm = new ManagePeopleViewModel(pk, level, organization);
 ko.applyBindings(vm);
});

</script>
{% endblock %}
{% block content %}
{% csrf_token %}
<input type="hidden" id="invite_organization_id" value="{{ organization }}">
<input type="hidden" id="invite_project_id" value="{{ project }}">
<input type="hidden" id="invite_site_id" value="{{ site }}">
<!-- {% if category == "site" %}
<input type="radio" name="group" id="invite_group" value="Reviewer" checked> Reviewer<br>
<input type="radio" name="group" id="invite_group" value="Site Supervisor"> Site Supervisor<br>
{% else %}
<input type="hidden" id="invite_group" value="{{ category }}">
{% endif %} -->


      <div id="main-content" class="padding">
              <nav aria-label="breadcrumb" role="navigation">
                {% block breadcrumbs %}
          <ol class="breadcrumb">
                      {% if level == "0" %}
            <li class="breadcrumb-item"><a href="{% url 'fieldsight:site-dashboard' pk %}">{{ obj.name }}</a></li>
                      {% endif %}
                      {% if level == "1" %}
            <li class="breadcrumb-item"><a href="{% url 'fieldsight:project-dashboard' pk %}">{{ obj.name }}</a></li>
                      {% endif %}
                      {% if level == "2" %}
            <li class="breadcrumb-item"><a href="{% url 'fieldsight:organizations-dashboard' pk %}">{{ obj.name }}</a></li>
                      {% endif %}
            <li class="breadcrumb-item active" aria-current="page">{% trans 'Manage' %} {% trans 'People' %}</li>
           </ol>
                {% endblock %}
              </nav>
          <div class="" data-bind="with:siteVm ,visible: currentVm() == 'site'" style="display:none;">
          <div class="tabbing margin-top">
          <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" data-toggle="tab" href="#tab001" role="tab">{% trans 'Assign' %} {% trans 'Site' %} {% trans 'Supervisors' %}</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#tab002" role="tab">{% trans 'Assign' %} {% trans 'Site' %} {% trans 'Reviewers' %}</a>
            </li>
          </ul>
          <!-- Tab panes -->
          <div class="tab-content">
            <div class="tab-pane active" id="tab001" role="tabpanel">
              <ul class="row">
                 

                      <div class="col-md-4">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>{% trans 'Current' %} {% trans 'Supervisors' %}</h4>
              </div>

              <div class="widget-body" data-bind="foreach:allSupervisors">
                <div class="project-item-wrap clearfix">
                  <div class="project-logo">
                    <img data-bind="attr:{src: user().profile_picture}" alt="" width="50" height="50">
                  </div>
                  <div class="project-basic-info">
                    <h4 data-bind="text:user().full_name"></h4>
                    <p data-bind="text:user().email"></p>
                  </div>
                  <a href="#" title="" class="btn btn-danger btn-sm project-action" data-bind="confirmClick: { message: 'Are you sure to remove this supervisor?', click:rmrole }"><i class="la la-close"></i></a>
                  </div>
                  </div>
                  </div>
                  </div>
            <div class="col-md-8">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>{% trans 'Invite' %} {% trans 'new' %} {% trans 'Supervisors' %}</h4>
              </div>
              <div class="widget-body">
                <form>
                  <div class="input-group">

                    <ul id="email1SiteTags">
                        
                    </ul>
                    <span class="input-group-btn">
                      <button class="btn btn-primary" id="retry" onclick="sendmultiplerequest('Site Supervisor', 1)" type="button"><i class="la la-user-plus"></i>{% trans 'Invite' %}</button>
                    </span>
                  </div>
                </form>


               
                <h4 class="text-center margin-top">
                <strong>{% trans 'OR' %}</strong>
                </h4>
                <div class="widget-head">
                <h4>{% trans 'Select' %} {% trans 'users' %} {% trans 'to' %} {% trans 'assign' %} {% trans 'as' %} {% trans 'supervisor' %}</h4>
                </div>
                <form class="margin-top">
                  <div class="input-group">
                    <input type="text" class="form-control" data-bind="value:$root.search_key, valueUpdate:'afterkeydown'" placeholder="Search..." aria-label="Search...">
                  </div>
                </form>
                 <input type="button" value="Select All" class="btn btn-primary margin-top" data-bind=" click:$root.setAllAssignAsSelected">
                 <input type="button" value="Unselect All" class="btn btn-primary margin-top" data-bind="click:$root.setAllUnSelected">
                  <button type="submit" class="btn btn-primary margin-top" data-bind="click:$root.assignsupervisors"><i class="la la-user-plus"></i>{% trans 'Assign' %} {% trans 'selected' %} {% trans 'as' %} {% trans 'Supervisors' %}</button>

                <ul class="row" data-bind="foreach:$root.users">
                  <li class="col-md-4">
                    <label class="custom-control margin-top user-checkbox custom-checkbox" >
                      <input type="checkbox" class="custom-control-input" data-bind="checked: selected, click:$root.setSelected">
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description">
                        <div class="project-item-wrap clearfix">
                          <div class="project-logo">
                            <img data-bind="attr:{src: user().profile_picture}" alt="" width="50" height="50">
                          </div>
                          <div class="project-basic-info">
                            <h4 data-bind="text:user().first_name+' '+user().last_name"></h4>
                            <p data-bind="text:user().email"></p>
                          </div>
                        </div>
                       <!--  <a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a> -->
                      </span>
                    </label>
                  </li>
                  
                  <li class="clearfix"></li>
                </ul>
                <div class="margin-top">
               
                </div>

              </div>
            </div>
          </div>




                  <li class="clearfix"></li>
                </ul>
            </div>
            
            <div class="tab-pane" id="tab002" role="tabpanel">



            <ul class="row">
                 

                      <div class="col-md-4">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>{% trans 'Current' %} {% trans 'Reviewers' %}</h4>
              </div>

              <div class="widget-body" data-bind="foreach:allReviewers">
                <div class="project-item-wrap clearfix">
                  <div class="project-logo">
                    <img data-bind="attr:{src: user().profile_picture}" alt="" width="50" height="50">
                  </div>
                  <div class="project-basic-info">
                    <h4 data-bind="text:user().full_name"></h4>
                    <p data-bind="text:user().email"></p>
                  </div>
                  <a href="#" title="" class="btn btn-danger btn-sm project-action" data-bind="confirmClick: { message: 'Are you sure to remove this reviewer?', click:rmrole }"><i class="la la-close"></i></a>
                  </div>
                  </div>
                  </div>
                  </div>


          <div class="col-md-8">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>{% trans 'Invite' %} {% trans 'New' %} {% trans 'Reviewers' %}</h4>
              </div>
              <div class="widget-body">
                <form>
                  <div class="input-group">

                    <ul id="email2SiteTags">    
                    </ul>
                    <span class="input-group-btn">
                      <button class="btn btn-primary" id="retry" onclick="sendmultiplerequest('Reviewer', 2)" type="button"><i class="la la-user-plus"></i>{% trans 'Invite' %}</button>
                    </span>
                  </div>
                </form>


               
                <h4 class="text-center margin-top">
                <strong>{% trans 'OR' %}</strong>
                </h4>
                <div class="widget-head">
                <h4>{% trans 'Select' %} {% trans 'users' %} {% trans 'to' %} {% trans 'assign' %} {% trans 'as' %} {% trans 'reviewer' %}</h4>
                </div>
                <form class="margin-top">
                  <div class="input-group">
                    <input type="text" class="form-control" data-bind="value:$root.search_key, valueUpdate:'afterkeydown'" placeholder="Search..." aria-label="Search...">
                  </div>
                </form>
                 <input type="button" value="Select All" class="btn btn-primary margin-top" data-bind=" click:$root.setAllAssignAsSelected">
                 <input type="button" value="Unselect All" class="btn btn-primary margin-top" data-bind="click:$root.setAllUnSelected">
                <button type="submit" class="btn btn-primary margin-top" data-bind="click:$root.assignreviewers"><i class="la la-user-plus"></i> {% trans 'Assign' %} {% trans 'selected' %} {% trans 'as' %} {% trans 'Reviewers' %}</button>
                <ul class="row" data-bind="foreach:$root.users">
                  <li class="col-md-4">
                    <label class="custom-control margin-top user-checkbox custom-checkbox" >
                      <input type="checkbox" class="custom-control-input" data-bind="checked: selected, click:$root.setSelected">
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description">
                        <div class="project-item-wrap clearfix">
                          <div class="project-logo">
                            <img data-bind="attr:{src: user().profile_picture}" alt="" width="50" height="50">
                          </div>
                          <div class="project-basic-info">
                            <h4 data-bind="text:user().first_name+' '+user().last_name"></h4>
                            <p data-bind="text:user().email"></p>
                          </div>
                        </div>
                        <!-- <a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a> -->
                      </span>
                    </label>
                  </li>
                  
                  <li class="clearfix"></li>
                </ul>
                <div class="margin-top">
                
             
                </div>

              </div>
            </div>
          </div>




                  <li class="clearfix"></li>
                </ul>





            </div>
          </div>
         <!--  <button type="submit" class="btn btn-primary btn-block"><i class="la la-user-plus"></i> Assign Users</button> -->
        </div>






      </div>



      <!-- for project -->

      <div class="" data-bind="with:projectVm ,visible: currentVm() == 'project'" style="display:none;">



      <div class="tabbing margin-top">
          <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" data-toggle="tab" href="#tab001" role="tab">{% trans 'Assign' %} {% trans 'Project' %} {% trans 'Managers' %}</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#tab002" role="tab">{% if obj.cluster_sites %}
                {% trans 'Assign' %} {% trans 'Region' %} {% trans 'Users' %}
                  {% else %}
                {% trans 'Assign' %} {% trans 'Site' %} {% trans 'Users' %}
                  {% endif %}</a>

            </li>
            <li class="nav-item">
              <a class="nav-link " data-toggle="tab" href="#tab003" role="tab">{% trans 'Assign' %} {% trans 'Donors' %}</a>
            </li>
          </ul>
          <!-- Tab panes -->
          <div class="tab-content">
            <div class="tab-pane active" id="tab001" role="tabpanel">
              <ul class="row">
                 


                    <div class="col-md-8">
                <div class="widget-info margin-top bg-white padding">
                  <div class="widget-head">
                    <h4>{% trans 'Invite' %} {% trans 'new' %} {% trans 'project' %} {% trans 'managers' %}</h4>
                  </div>
                  <div class="widget-body">
                    <form>
                      <div class="input-group">

                       <ul id="email1ProjectTags">
                            
                        </ul>
                        <span class="input-group-btn">
                          <button class="btn btn-primary" id="retry" onclick="sendmultiplerequest('Project Manager', 1)" type="button"><i class="la la-user-plus"></i> {% trans 'Invite' %}</button>
                        </span>
                      </div>
                    </form>


                   
                    <h4 class="text-center margin-top">
                    <strong>{% trans 'OR' %}</strong>
                    </h4>
                    <div class="widget-head">
                    <h4>{% trans 'Select' %} {% trans 'Users' %} {% trans 'to' %} {% trans 'assign' %} {% trans 'as' %} {% trans 'Project' %} {% trans 'Managers' %}</h4>
                    </div>
                   
                    <form class="margin-top">
                      <div class="input-group">
                        <input type="text" class="form-control" data-bind="value:$root.search_key, valueUpdate:'afterkeydown'" placeholder="Search..." aria-label="Search...">
                      </div>
                    </form>
                     <input type="button" value="Select All" class="btn btn-primary margin-top" data-bind=" click:$root.setAllAssignAsSelected">
                     <input type="button" class="btn btn-primary margin-top" value="Unselect All" data-bind="click:$root.setAllUnSelected">

               
                <button type="submit" class="btn btn-primary margin-top" data-bind="click:$root.assignPM"><i class="la la-user-plus"></i> {% trans 'Assign' %} {% trans 'selected' %} {% trans 'as' %} {% trans 'Project' %} {% trans 'Manager' %}</button>
               
                <ul class="row" data-bind="foreach:$root.users">
                  <li class="col-md-4">
                    <label class="custom-control margin-top user-checkbox custom-checkbox" >
                      <input type="checkbox" class="custom-control-input" data-bind="checked: selected, click:$root.setSelected">
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description">
                        <div class="project-item-wrap clearfix">
                          <div class="project-logo">
                            <img data-bind="attr:{src: user().profile_picture}" alt="" width="50" height="50">
                          </div>
                          <div class="project-basic-info">
                            <h4 data-bind="text:user().first_name+' '+user().last_name"></h4>
                            <p data-bind="text:user().email"></p>
                          </div>
                        </div>
                        <!-- <a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a> -->
                      </span>
                    </label>
                  </li>
                  
                  <li class="clearfix"></li>
                </ul>
                <div class="margin-top">

                </div>
            </div>
            </div>
            </div>

            <div class="col-md-4">
              <div class="widget-info margin-top bg-white padding">
                <div class="widget-head">
                  <h4>{% trans 'Current' %} {% trans 'Project' %} {% trans 'Managers' %}</h4>
                </div>

                <div class="widget-body" data-bind="foreach:projectManagers">
                  <div class="project-item-wrap clearfix">
                    <div class="project-logo">
                      <img data-bind="attr:{src: user().profile_picture}" alt="" width="50" height="50">
                    </div>
                    <div class="project-basic-info">
                      <h4 data-bind="text:user().full_name"></h4>
                      <p data-bind="text:user().email"></p>
                    </div>
                    <a href="#" title="" class="btn btn-danger btn-sm project-action" data-bind="confirmClick: { message: 'Are you sure to remove this Project Manager?', click:rmrole }"><i class="la la-close"></i></a>



                    <li class="clearfix"></li>
                  </ul>
              </div>
            <div class="tab-pane" id="tab002" role="tabpanel">
              <ul class="row">
                  

                      <div class="row">
          <div class="col-md-6">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>{% trans 'Invite' %} {% trans 'new' %} {% trans 'users' %}</h4>
              </div>

              <div class="widget-body">

                <!-- <ul class="row max-260-scroll" id="multi-ass-users">
                <input type="button" value="Select All" onclick="selectall('users')">
                 <input type="button" value="Unselect All" onclick="unselectall('users')">


                  
                
                 
                </ul> -->
                 <div class="input-group">
                     <ul id="email2ProjectTags">
                    </ul>
                    <span class="input-group-btn">
                      
                      <span class="dropdown">
                    <a href="#" id="dropdownMenuButtonManage" class="btn btn-primary margin-top" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="la la-cogs"></i>{% trans 'Invite' %}
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButtonManage" x-placement="bottom-end" style="background-color: #00628E; position: absolute; transform: translate3d(74px, 24px, 0px); top: 0px; left: 0px; will-change: transform;">

                    {% if obj.cluster_sites %}
                      <a class="dropdown-item" href="#" data-bind="click:invite_supervisors_regions"><i class="la la-user"></i>{% trans 'As' %} {% trans 'Region' %} {% trans 'Supervisor' %}</a>
                      <a class="dropdown-item" href="#" data-bind="click:invite_reviewers_regions"><i class="la la-clipboard"></i>{% trans 'As' %} {% trans 'Region' %} {% trans 'Reviewer' %}</a>

                    {% else %}
                      <a class="dropdown-item" href="#" data-bind="click:invitesupervisorsSites"><i class="la la-user"></i>{% trans 'As' %} {% trans 'Site' %} {% trans 'Supervisor' %}</a>
                      <a class="dropdown-item" href="#" data-bind="click:invitereviewersSites"><i class="la la-clipboard"></i>{% trans 'As' %} {% trans 'Reviewer' %}</a>
                    {% endif %}


                     
                    </div>
                  </span>



                     
                    </span>
                  </div>
                  <br>
                  <h4 class="text-center margin-top">
                <strong>OR</strong>
                </h4>
                <div class="widget-head">
                <h4>
                    {% if obj.cluster_sites %}
                {% trans 'Select' %} {% trans 'Users' %} {% trans 'to' %} {% trans 'assign' %} {% trans 'to' %} {% trans 'all' %} {% trans 'sites' %} {% trans 'in' %} {% trans 'regions.' %}
                  {% else %}
                {% trans 'Select' %} {% trans 'Users' %} {% trans 'to' %} {% trans 'assign' %} {% trans 'to' %} {% trans 'sites' %}
                  {% endif %}
                </h4>
                </div>
                  <input type="text" class="form-control" data-bind="value:$root.search_key, valueUpdate:'afterkeydown'" placeholder="Search users..." aria-label="Search...">
                  <input type="button" value="Select All" class="btn btn-primary margin-top" data-bind=" click:$root.setAllAssignAsSelected">
                 <input type="button" value="Unselect All" class="btn btn-primary margin-top" data-bind="click:$root.setAllUnSelected">
                 <span class="dropdown">
                            <a href="#" id="dropdownMenuButtonManage" class="btn btn-primary margin-top" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                              <i class="la la-cogs"></i> {% trans 'Assign' %} {% trans 'Selected' %} {% trans 'Users' %}
                            </a>

                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButtonManage" x-placement="bottom-end" style="background-color: #00628E; position: absolute; transform: translate3d(74px, 24px, 0px); top: 0px; left: 0px; will-change: transform;">
                                                     {% if obj.cluster_sites %}

                              <a class="dropdown-item" href="#"  data-bind="click:assign_selected_region_supervisor"><i class="la la-user"></i>{% trans 'As' %} {% trans 'Region' %} {% trans 'Supervisor' %}</a>
                              <a class="dropdown-item" href="#"  data-bind="click:assign_selected_reviewer"><i class="la la-clipboard"></i>{% trans 'As' %} {% trans 'Region' %} {% trans 'Reviewer' %}</a>
                                                    {% else %}
                                <a class="dropdown-item" href="#"  data-bind="click:assignselectedsupervisor"><i class="la la-user"></i>{% trans 'As' %} {% trans 'Site' %} {% trans 'Supervisor' %}</a>
                              <a class="dropdown-item" href="#"  data-bind="click:assignselectedreviewer"><i class="la la-clipboard"></i>{% trans 'As' %} {% trans 'Reviewer' %}</a>
                      {% endif %}


                            </div>


                          </span>
                <ul class="row" data-bind="foreach:$root.users">
                  <li class="col-md-12">
                    <label class="custom-control margin-top user-checkbox custom-checkbox" >
                      <input type="checkbox" class="custom-control-input" data-bind="checked: selected, click:$root.setSelected">
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description">
                        <div class="project-item-wrap clearfix">
                          <div class="project-logo">
                            <img data-bind="attr:{src: user().profile_picture}" alt="" width="50" height="50">
                          </div>
                          <div class="project-basic-info">
                            <h4 data-bind="text:user().first_name+' '+user().last_name"></h4>
                            <p data-bind="text:user().email"></p>
                          </div>
                        </div>
                       
                      </span>
                    </label>
                  </li>
                  
                  <li class="clearfix"></li>
                </ul>
                <input style="display:none;" type="button" id="getnextlist" onclick="" value="load more">
                <input type="radio" style="display:none;" name="group" id="group" value="Project Manager" checked>
              </div>
            </div>
          </div>



          <div class="col-md-6">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>
                  {% if obj.cluster_sites %}
                  <!--<p><input type="button" value="Assign selected users to this Project" class="btn btn-primary margin-top" data-bind="click:assign_selected_to_project"></p>-->
                  <br>
                  {% trans 'Select' %} {% trans 'Regions' %}
                  {% else %}
                  {% trans 'Select' %} {% trans 'Sites' %}
                  {% endif %}
                </h4>

              </div>
              <div class="widget-body">
                <!-- <ul class="row max-260-scroll" id="multi-ass-proj_site">
                  <input type="button" value="Select All" onclick="selectall('proj_site')">
                 <input type="button" value="Unselect All" onclick="unselectall('proj_site')">

                </ul>
                <input style="display:none;" type="button" id="getnextproj_site_list" onclick="" value="load more"> -->

                {% if obj.cluster_sites %}

                <input type="text" class="form-control" data-bind="value:region_search_key, valueUpdate:'afterkeydown'" placeholder="Search..." aria-label="Search Sites...">
                  <input type="button" value="Select All" class="btn btn-primary margin-top" data-bind=" click:setAllAssignRegionAsSelected">
                 <input type="button" value="Unselect All" class="btn btn-primary margin-top" data-bind="click:setAllRegionUnSelected">
                <ul class="row" data-bind="foreach:regions">
                
                  <li class="col-md-12">
                    <label class="custom-control margin-top user-checkbox custom-checkbox" >
                      <input type="checkbox" class="custom-control-input" data-bind="checked: selected, click:$parent.setRegionSelected">
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description">
                        <div class="project-item-wrap clearfix">
                         <!--  <div class="project-logo">
                            <img data-bind="attr:{src: logo()}" alt="" width="50" height="50">
                          </div> -->
                          <div class="project-basic-info">
                            <h4 data-bind="text:identifier()"></h4>
                            <p data-bind="text:name()"></p>
                          </div>
                        </div>

                       
                      </span>
                    </label>

                  </li>
                  
                  <li class="clearfix"></li>
                </ul>
                

   
                {% else %}

               <input type="text" class="form-control" data-bind="value:search_key, valueUpdate:'afterkeydown'" placeholder="Search..." aria-label="Search Sites...">
                  <input type="button" value="Select All" class="btn btn-primary margin-top" data-bind=" click:setAllAssignSiteAsSelected">
                 <input type="button" value="Unselect All" class="btn btn-primary margin-top" data-bind="click:setAllSiteUnSelected">
                <ul class="row" data-bind="foreach:sites">
                
                  <li class="col-md-12">
                    <label class="custom-control margin-top user-checkbox custom-checkbox" >
                      <input type="checkbox" class="custom-control-input" data-bind="checked: selected, click:$parent.setSiteSelected">
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description">
                        <div class="project-item-wrap clearfix">
                          <div class="project-logo">
                            <img data-bind="attr:{src: logo()}" alt="" width="50" height="50">
                          </div>
                          <div class="project-basic-info">
                            <h4 data-bind="text:name()"></h4>
                            <p data-bind="text:email()"></p>
                          </div>
                        </div>
                       
                      </span>
                    </label>
                  </li>
                  
                  <li class="clearfix"></li>
                </ul>

                
                
               
                {% endif %}

              </div>
            </div>
          </div>


          
        </div>


                  <li class="clearfix"></li>
                </ul>
            </div>





            <div class="tab-pane" id="tab003" role="tabpanel">
              <ul class="row">
                 


                    <div class="col-md-8">
                <div class="widget-info margin-top bg-white padding">
                  <div class="widget-head">
                    <h4>{% trans 'Invite' %} {% trans 'new' %} {% trans 'Donors' %}</h4>
                  </div>
                  <div class="widget-body">
                    <form>
                      <div class="input-group">

                       <ul id="email3ProjectTags">
                            
                        </ul>
                        <span class="input-group-btn">
                          <button class="btn btn-primary" id="retry" onclick="sendmultiplerequest('Project Donor', 3)" type="button"><i class="la la-user-plus"></i> {% trans 'Invite' %}</button>
                        </span>
                      </div>
                    </form>


                   
                    <h4 class="text-center margin-top">
                    <strong>{% trans 'OR' %}</strong>
                    </h4>
                    <div class="widget-head">
                    <h4>{% trans 'Select' %} {% trans 'Users' %} {% trans 'to' %} {% trans 'assign' %} {% trans 'as' %} {% trans 'Donors' %}</h4>
                    </div>
                   
                    <form class="margin-top">
                      <div class="input-group">
                        <input type="text" class="form-control" data-bind="value:$root.search_key, valueUpdate:'afterkeydown'" placeholder="Search..." aria-label="Search...">
                      </div>
                    </form>
                     <input type="button" value="Select All" class="btn btn-primary margin-top" data-bind=" click:$root.setAllAssignAsSelected">
                     <input type="button" class="btn btn-primary margin-top" value="Unselect All" data-bind="click:$root.setAllUnSelected">

                    <button type="submit" class="btn btn-primary margin-top" data-bind="click:$root.assignDonor"><i class="la la-user-plus"></i> {% trans 'Assign' %} {% trans 'selected' %} {% trans 'as' %} {% trans 'Donors' %}</button>
                   
                    <ul class="row" data-bind="foreach:$root.users">
                      <li class="col-md-4">
                        <label class="custom-control margin-top user-checkbox custom-checkbox" >
                          <input type="checkbox" class="custom-control-input" data-bind="checked: selected, click:$root.setSelected">
                          <span class="custom-control-indicator"></span>
                          <span class="custom-control-description">
                            <div class="project-item-wrap clearfix">
                              <div class="project-logo">
                                <img data-bind="attr:{src: user().profile_picture}" alt="" width="50" height="50">
                              </div>
                              <div class="project-basic-info">
                                <h4 data-bind="text:user().first_name+' '+user().last_name"></h4>
                                <p data-bind="text:user().email"></p>
                              </div>
                            </div>
                            <!-- <a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a> -->
                          </span>
                        </label>
                      </li>
                      
                      <li class="clearfix"></li>
                    </ul>
                    <div class="margin-top">
                    </div>

                  </div>
                </div>
            </div>

            <div class="col-md-4">
              <div class="widget-info margin-top bg-white padding">
                <div class="widget-head">
                  <h4>{% trans 'Current' %} {% trans 'Donors' %}</h4>
                </div>

                <div class="widget-body" data-bind="foreach:projectDonors">
                  <div class="project-item-wrap clearfix">
                    <div class="project-logo">
                      <img data-bind="attr:{src: user().profile_picture}" alt="" width="50" height="50">
                    </div>
                    <div class="project-basic-info">
                      <h4 data-bind="text:user().full_name"></h4>
                      <p data-bind="text:user().email"></p>
                    </div>
                    <a href="#" title="" class="btn btn-danger btn-sm project-action" data-bind="confirmClick: { message: 'Are you sure to remove this donor?', click:rmrole }"><i class="la la-close"></i></a>



                    <li class="clearfix"></li>
                  </ul>
              </div>
          </div>
         <!--  <button type="submit" class="btn btn-primary btn-block"><i class="la la-user-plus"></i> Assign Users</button> -->
        </div>



          



          <span class="closebtn-cu"><i class="fa fa-times" aria-hidden="true"></i></span>
        </div>


 <!-- for project -->

      <div class="" data-bind="with:orgVm, visible: currentVm() == 'organization'" style="display:none;">



      <div class="tabbing margin-top">
          <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" data-toggle="tab" href="#tab001" role="tab">{% trans 'Assign' %} {% trans 'Organization' %} {% trans 'Admins' %}</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#tab002" role="tab">{% trans 'Assign' %} {% trans 'Project' %} {% trans 'Managers' %}</a>
            </li>
          </ul>
          <!-- Tab panes -->
          <div class="tab-content">
            <div class="tab-pane active" id="tab001" role="tabpanel">
              <ul class="row">
                 


                  <div class="col-md-8">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>{% trans 'Invite' %} {% trans 'new' %} {% trans 'organization' %} {% trans 'admins' %}</h4>
              </div>
              <div class="widget-body">
                <form>
                  <div class="input-group">

                  <ul id="email1OrgTags">
                        
                    </ul>
                    <span class="input-group-btn">
                      <button class="btn btn-primary" id="retry" onclick="sendmultiplerequest('Organization Admin', 1)" type="button"><i class="la la-user-plus"></i> {% trans 'Invite' %}</button>
                    </span>
                  </div>
                </form>


               
                <h4 class="text-center margin-top">
                <strong>{% trans 'OR' %}</strong>
                </h4>
                 <div class="widget-head">
                <h4>{% trans 'Select' %} {% trans 'users' %} {% trans 'to' %} {% trans 'assign' %} {% trans 'as' %} {% trans 'organization' %} {% trans 'admin' %}</h4>
                </div>
                  <form class="margin-top">
                    <div class="input-group">
                      <input type="text" class="form-control" data-bind="value:$root.search_key, valueUpdate:'afterkeydown'" placeholder="Search..." aria-label="Search...">
                    </div>
                  </form>
                 <input type="button" class="btn btn-primary margin-top" value="Select All" data-bind=" click:$root.setAllAssignAsSelected">
                 <input type="button" class="btn btn-primary margin-top" value="Unselect All" data-bind="click:$root.setAllUnSelected">

                  <button type="submit" class="btn btn-primary margin-top" data-bind="click:$root.assignOadmin"><i class="la la-user-plus"></i> {% trans 'Assign' %} {% trans 'Organization' %} {% trans 'Admin' %}</button>
                  <ul class="row" data-bind="foreach:$root.users">
                  <li class="col-md-4">
                    <label class="custom-control margin-top user-checkbox custom-checkbox" >
                      <input type="checkbox" class="custom-control-input" data-bind="checked: selected, click:$root.setSelected">
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description">
                        <div class="project-item-wrap clearfix">
                          <div class="project-logo">
                            <img data-bind="attr:{src: user().profile_picture}" alt="" width="50" height="50">
                          </div>
                          <div class="project-basic-info">
                            <h4 data-bind="text:user().first_name+' '+user().last_name"></h4>
                            <p data-bind="text:user().email"></p>
                          </div>
                        </div>
                       <!--  <a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a> -->
                      </span>
                    </label>
                  </li>
                  
                  <li class="clearfix"></li>
                </ul>
                <div class="margin-top">
                
               
                </div>

              </div>
            </div>
          </div>

          <div class="col-md-4">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>{% trans 'Current' %} {% trans 'Organization' %} {% trans 'Admins' %}</h4>
              </div>

              <div class="widget-body" data-bind="foreach:admins">
                <div class="project-item-wrap clearfix">
                  <div class="project-logo">
                    <img data-bind="attr:{src: user().profile_picture}" alt="" width="50" height="50">
                  </div>
                  <div class="project-basic-info">
                    <h4 data-bind="text:user().full_name"></h4>
                    <p data-bind="text:user().email"></p>
                  </div>
                  <a href="#" title="" class="btn btn-danger btn-sm project-action" data-bind="confirmClick: { message: 'Are you sure to remove this Organization Admin?', click:rmrole }"><i class="la la-close"></i></a>



                  <li class="clearfix"></li>
                </ul>
            </div>
            <div class="tab-pane" id="tab002" role="tabpanel">
              <ul class="row">
                  

                      <div class="row">
          <div class="col-md-6">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>{% trans 'Invite' %} {% trans 'new' %} {% trans 'project' %} {% trans 'managers' %}</h4>
              </div>
              <div class="widget-body">

                <!-- <ul class="row max-260-scroll" id="multi-ass-users">
                <input type="button" value="Select All" onclick="selectall('users')">
                 <input type="button" value="Unselect All" onclick="unselectall('users')">


                  
                
                 
                </ul> -->
                 <div class="input-group">
                     <ul id="email2OrgTags">
                    </ul>
                    <span class="input-group-btn">
                      <button class="btn btn-primary" id="retry" data-bind="click:inviteforemails" type="button"><i class="la la-user-plus"></i> {% trans 'Invite' %}</button>
                    </span>
                  </div>
                  <br>
                 <h4 class="text-center margin-top">
                <strong>{% trans 'OR' %}</strong>
                </h4>
                  <div class="widget-head">
                <h4>{% trans 'Select' %} {% trans 'users' %} {% trans 'to' %} {% trans 'assign' %} {% trans 'to' %} {% trans 'projects' %}</h4>
              </div>
                  <input type="text" class="form-control" data-bind="value:$root.search_key, valueUpdate:'afterkeydown'" placeholder="Search..." aria-label="Search...">
                  <input type="button" value="Select All" class="btn btn-primary margin-top"  data-bind=" click:$root.setAllAssignAsSelected">
                 <input type="button" value="Unselect All" class="btn btn-primary margin-top" data-bind="click:$root.setAllUnSelected">
                <ul class="row" data-bind="foreach:$root.users">
                  <li class="col-md-12">
                    <label class="custom-control margin-top user-checkbox custom-checkbox" >
                      <input type="checkbox" class="custom-control-input" data-bind="checked: selected, click:$root.setSelected">
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description">
                        <div class="project-item-wrap clearfix">
                          <div class="project-logo">
                            <img data-bind="attr:{src: user().profile_picture}" alt="" width="50" height="50">
                          </div>
                          <div class="project-basic-info">
                            <h4 data-bind="text:user().first_name+' '+user().last_name"></h4>
                            <p data-bind="text:user().email"></p>
                          </div>
                        </div>
                       
                      </span>
                    </label>
                  </li>
                  
                  <li class="clearfix"></li>
                </ul>
                <input style="display:none;" type="button" id="getnextlist" onclick="" value="load more">
                <input type="radio" style="display:none;" name="group" id="group" value="Project Manager" checked>
              </div>
            </div>
          </div>



          <div class="col-md-6">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>{% trans 'Select' %} {% trans 'Projects' %}</h4>
              </div>
              <div class="widget-body">
                <!-- <ul class="row max-260-scroll" id="multi-ass-proj_site">
                  <input type="button" value="Select All" onclick="selectall('proj_site')">
                 <input type="button" value="Unselect All" onclick="unselectall('proj_site')">

                </ul>
                <input style="display:none;" type="button" id="getnextproj_site_list" onclick="" value="load more"> -->
                <input type="text" class="form-control" data-bind="value:search_key, valueUpdate:'afterkeydown'" placeholder="Search..." aria-label="Search...">
                  <input type="button" value="Select All" class="btn btn-primary margin-top" data-bind="click:setAllAssignAsSelected">
                 <input type="button" value="Unselect All" class="btn btn-primary margin-top" data-bind="click:setAllUnSelected">
                 <button type="submit" class="btn btn-primary margin-top" data-bind="click:doAssign"><i class="la la-user-plus"></i> {% trans 'Assign' %} {% trans 'as' %} {% trans 'Project' %} {% trans 'Managers' %}</button>
  

                <ul class="row" data-bind="foreach:projects">
                
                  <li class="col-md-12">
                    <label class="custom-control margin-top user-checkbox custom-checkbox" >
                     
                       <input type="checkbox" class="custom-control-input" data-bind="checked: selected, click:$parent.setSelected">

                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description">
                        <div class="project-item-wrap clearfix">
                          <div class="project-logo">
                            <img data-bind="attr:{src: logo()}" alt="" width="50" height="50">
                          </div>
                          <div class="project-basic-info">
                            <h4 data-bind="text:name()"></h4>
                            <p data-bind="text:email()"></p>
                          </div>
                        </div>
                       
                      </span>
                    </label>
                  </li>
                  
                  <li class="clearfix"></li>
                </ul>
                
              </div>
            </div>
          </div>




                  <li class="clearfix"></li>
                </ul>
            </div>
          </div>
         <!--  <button type="submit" class="btn btn-primary btn-block"><i class="la la-user-plus"></i> Assign Users</button> -->
        </div>



          



          <span class="closebtn-cu"><i class="fa fa-times" aria-hidden="true"></i></span>
        </div>
                </div>
                
            </div>
          </div>



    
        <!-- <div class="margin-top">
          <div class="padding bg-white">
            <button type="submit" class="btn btn-primary btn-block"><i class="la la-user-plus"></i> Assign Users</button>
          </div>
        </div> -->
        </div>
        </div><div class="modal fade" id="myinvitemodal" role="dialog" >
                      <div class="modal-dialog">
                      
                        <!-- Modal content-->
                        <div class="modal-content" style="margin-top: 15%;">
                          <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">{% trans 'Invite' %} {% trans 'Status' %}</h4>
                          </div>
                          <div class="modal-body">
                          <center>
                            <div id="update-next-step">
                            <h2>{% trans 'Inviting ...' %}</h2>
                          
                            </div>
                            </center>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">{% trans 'Close' %}</button>
                          </div>
                        </div>
                        
                      </div>
                    </div>

<script>
var ajax_call=false;
var is_emails_valid = true;
// function refresh(group){
//   var email = $("#invite_email").val();
  

//   // if(email.indexOf(',') > -1){

//   //       // alert('ola');
//         sendmultiplerequest(email);

//   //       return false;  
//   // }
//   // else{
//   // data = validateemail(email);
  
//   // if(data.status == false){
//   //   return false;
//   // }

//   // ajax_call = true;
//   // checkemail(email);
//   // }   
// }
// function validateemail(email){
//   var atherate = email.indexOf("@");
//   var dot = email.indexOf(".", atherate);
    
//       if(atherate != -1 && dot != -1){
//         return {
//         status: true,
//         email: email
//         };
//       }
//       else{
//         // alert("Enter valid email address.");
//         return {
//         status: false,
//         email: email
//         };
//       }
// }

function validateEmail(email) {
  var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
  return re.test(email);
}

function validateemail(email) {
  if (validateEmail(email)) {
        return {
        is_emails_valid: true,
        email: email
        };

  } 
        return {

            is_emails_valid: false,
            email: email
            };
  
  
}


 function getNewInsertion(newValue) {
     if(newValue.indexOf(',') > -1){
        $("#retry").val('Invite Users');  
        }
     else{
       $("#retry").val('Search User');
     }
}

function multiemailvalidate(entry) {
    email_res = validateemail(entry);
    if(!email_res.is_emails_valid){
      
      is_emails_valid=false;


      }
    }

function sendmultiplerequest(group, emailbox){

  if (emailbox == 2){
    emails=emails2;
 
  }
  else if(emailbox == 3){
    emails=emails3;
  }
    else{
    emails=emails1;
  }

    if(!emails[0]){
      alert("Please insert an email to invite.");
      return false;
    }

    is_emails_valid=true;
     emails.forEach(multiemailvalidate);

    if(is_emails_valid){ sendinvite(emails, group); }
    else{ alert('Contains Invalid Email.'); }
}


// function multiemailvalidate(entry) {
//     email_res = validateemail(entry);
//     if(email_res.status == false){
      
//       var email_input = document.getElementById("invite_email");
//       email = email_input.value;
//       start = email.search(email_res.email);
//       end = email.indexOf(",", start);
//       // console.log(start +" "+ end);
//       email_input.setSelectionRange(start, end);
//       email_input.focus();
//       status=false;


//       }
//     }

$(function(){

    $("#invite_email").bind("paste cut keydown",function(e) {
        var that = this;
        
        setTimeout(function() {
                
                if(typeof $(that).data("old_value") == "undefined") {
                    $(that).data("old_value",$(that).val());
                }
                
                getNewInsertion($(that).val());

            },200);

    })

}); 


function log(val) {
    console.log(val);
}

  function checkemail(email){
        $.ajax({
        url: "{% url 'fieldsight:check-email-for-invite' %}",
        data: {'email': email, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
        type: 'POST',
        success: function (html) {
           $('#update-next-step').html(html);
           $('#retry').show();
        }
      });
  }

function sendnewuserinvite(){
  emails = [];
  var email = $("#invite_email").val();
  emails.push(email);
  sendinvite(emails);
}
      

  </script>
{% if category == "site" %}

<script>
  function sendinvite(emails, group){
      $('#myinvitemodal').modal(); 
      var organization_id = $("#invite_organization_id").val();
      var project_id = $("#invite_project_id").val();
      var site_id = $("#invite_site_id").val();
      // console.log(emails);
      // console.log(group);
      // console.log(project_id);
      // console.log(site_id);
      // console.log(organization_id);
      $.ajax({
        url: "{% url 'fieldsight:senduserinvite' %}",
        data: {'emails[]': emails, 'organization_id':organization_id,'project_id':project_id,'site_id':site_id,'group':group, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
        type: 'POST',
        success: function (html) {
           $('#update-next-step').html(html);
        }
      });
    }
</script>
{% else %}
<script>
  function sendinvite(emails, group){ 
      $('#myinvitemodal').modal(); 
      var organization_id = $("#invite_organization_id").val();
      var project_id = $("#invite_project_id").val();
      var site_id = $("#invite_site_id").val();
      
      $.ajax({
        url: "{% url 'fieldsight:senduserinvite' %}",
        data: {'emails[]': emails, 'organization_id':organization_id,'project_id':project_id,'site_id':site_id,'group':group, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
        type: 'POST',
        success: function (html) {

           $('#update-next-step').html(html);
            
        }
      });
}
///////////////////// END OF USER INVITE SCRIPT
</script>

{% endif %}


<script type="text/javascript">


///// Multi user assign starts here.
console.log(userurl);



// document.onload = getuserlist(userurl);
// document.onload = getproj_site_url_list(proj_site_url);


// function getuserlist(url){
   
//       $.ajax({
//         url: url,
//         type: 'GET',
//         success: function (data) {
//            data.forEach(populateuserlist);
//            speed=0;
//            if (data.next == null){
//             document.getElementById('getnextlist').style.display = 'none';
//            }else{
//             document.getElementById('getnextlist').style.display = 'block';
//             document.getElementById("getnextlist").setAttribute( "onClick", "javascript: getuserlist('"+ data.next+"');" );
//         }
//         // console.log(data);
//         }
//       });
// }

// function getproj_site_url_list(url){
//       $.ajax({
//         url: url,

//         type: 'GET',
//         success: function (data) {
//            speed_proj_site=0;
//            data.forEach(populate_proj_site_list);
           
//            if (data.next == null){
//             document.getElementById('getnextproj_site_list').style.display = 'none';
//            }else{
//             document.getElementById('getnextproj_site_list').style.display = 'block';
//             document.getElementById("getnextproj_site_list").setAttribute( "onClick", "javascript: getproj_site_url_list('"+ data.next+"');" );
//         }
//         }
//       });
// }

////////////////////////////////--- Populate Lists

function populateuserlist(data, index){

all_users.push(data.user.id);

var user_list = '<li class="col-md-12" id="'+data.user.id+'usersli">'+
                    '<label class="custom-control margin-top user-checkbox custom-checkbox">'+
                      '<input type="checkbox" class="custom-control-input" onclick="checkifuserisselected('+ data.user.id +')">'+
                      '<span class="custom-control-indicator"></span>'+
                      '<span class="custom-control-description">'+
                        '<div class="project-item-wrap clearfix">'+
                          '<div class="project-logo">'+
                            '<img src="'+ data.user.profile_picture +'" alt="" width="50" height="50">'+
                          '</div>'+
                          '<div class="project-basic-info">'+
                            '<h4>' + data.user.first_name +' '+ data.user.last_name+ '</h4>'+
                            '<p>'+ data.user.email +'</p>'+
                          '</div>'+
                        '</div>'+
                        // '<a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a>'+
                      '</span>'+
                    '</label>'+
                  '</li>';


    // var user_list = '<li class="note-div-sm '+ data.id +'" id="'+data.id+'usersli" style="display:none;" onclick="checkifuserisselected(`'+ data.user.id +'`)"> <div class="col-md-1"><i class="fa fa-info-circle fa-1 note-icon-sm"></i> </div>   <div class="col-md-10"><span class="detail-text1 notification-title-sm">'+ data.user.username +'</span><div class="low">  <i class="fa fa-clock-o space" aria-hidden="true"></i>'+ data.user.email +' </div></div>  </li>';

    // var div = document.getElementById('notifications');

    // div.innerHTML += new_li;
    speed = speed+200;

$(user_list).appendTo("#multi-ass-users");
$("#"+data.id+"usersli").fadeIn(speed);
}



function populate_proj_site_list(data, index){

all_proj_site.push(data.id);

    var new_proj_site_list = '<li class="col-md-12" id="'+data.id+'proj_site_li">'+
                    '<label class="custom-control margin-top user-checkbox custom-checkbox">'+
                      '<input type="checkbox" class="custom-control-input" onclick="checkifproj_siteisselected('+ data.id +')">'+
                      '<span class="custom-control-indicator"></span>'+
                      '<span class="custom-control-description">'+
                        '<div class="project-item-wrap clearfix">'+
                          '<div class="project-logo">'+
                            '<img src="'+ data.logo +'" alt="" width="50" height="50">'+
                          '</div>'+
                          '<div class="project-basic-info">'+
                            '<h4>' + data.name + '</h4>'+
                            '<p>'+ data.type_label +'</p>'+
                          '</div>'+
                        '</div>'+
                        // '<a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a>'+
                      '</span>'+
                    '</label>'+
                  '</li>';
    // var div = document.getElementById('notifications');

    // div.innerHTML += new_li;
    speed_proj_site = speed_proj_site+200;

$(new_proj_site_list).appendTo("#multi-ass-proj_site");
$("#"+data.id+"proj_site_li").fadeIn(speed_proj_site);
}

///////////////---- Multiple Select / Unselect

function selectall(type){
  if(type=="users"){
  selected_users = all_users;
  $('#multi-ass-users').find(':checkbox').each(function(){
        $(this).attr('checked', true); 
   });

  }

  else if(type=="proj_site"){
    selected_proj_site = all_proj_site;
    $('#multi-ass-proj_site').find(':checkbox').each(function(){
        $(this).attr('checked', true); 
   });
 }
}

function unselectall(type){
  if(type=="users"){
  selected_users = [];
    $('#multi-ass-users').find(':checkbox').each(function(){
        $(this).attr('checked', false); 
   });
  }
  
  else if(type=="proj_site"){
    selected_proj_site = [];
    $('#multi-ass-proj_site').find(':checkbox').each(function(){
        $(this).attr('checked', false); 
   });
  }
}


///////////////////------ Unassign / Assign individually checked list


function checkifuserisselected(id){

  res = selected_users.indexOf(id);
  if(res > -1){
    selected_users.splice(res, 1);
  }
  else{
    selected_users.push(id);
  }
  console.log(selected_users);
}

function checkifproj_siteisselected(id){

  res = selected_proj_site.indexOf(id);
  if(res > -1){
    selected_proj_site.splice(res, 1);
  }
  else{
    selected_proj_site.push(id);
  }
    console.log(selected_proj_site);
}


////////////////// - -------- Finally Send request to server.


function assignusers(url){

      group = $( 'input[id=group]:checked' ).val();
      alert(group);
      alert(selected_users);
      alert(selected_proj_site);
      $.ajax({
        url:url,
        data: {'users[]': selected_users, 'proj_site[]':selected_proj_site, 'group':group, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
        type: 'POST',
        success: function (html) {
           $('#update-next-step').html(html);
        }

});
    }


</script>
    {% endblock %}
